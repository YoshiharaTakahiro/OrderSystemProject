-- 受発注管理システムDB作成スクリプト

-- データベース削除
DROP DATABASE omdb;

-- データベース作成(DB名：OMDB)
CREATE DATABASE omdb;

-- データベース移動
USE omdb;

-- ユーザ作成(User名：omuser)
DROP USER omuser;
CREATE USER omuser IDENTIFIED WITH MYSQL_NATIVE_PASSWORD BY 'omuser';
-- CREATE USER omuser IDENTIFIED BY 'omuser';

-- ユーザにデータベース権限付与
GRANT ALL ON omdb.* TO omuser;

/*---------------以下テーブル作成----------------------*/

-- 全テーブル削除
DROP TABLE DETAILS;
DROP TABLE ORDERS;
DROP TABLE SUPPLIERS;
DROP TABLE PRODUCTS;
DROP TABLE COLORS;
DROP TABLE USERS;
DROP TABLE DEPARTMENTS;
DROP TABLE TAXS;
DROP TABLE GENERALS;

-- 汎用マスタ作成
CREATE TABLE GENERALS(
    DIVISION        VARCHAR(3),
    GENERAL_CODE    VARCHAR(3),
    GENERAL_NAME    VARCHAR(20) NOT NULL,
    PRIMARY KEY(DIVISION, GENERAL_CODE)
);

-- 税率マスタ作成
CREATE TABLE TAXS(
    TAX_CODE    int(2)  PRIMARY KEY AUTO_INCREMENT,
    TAX         int(2)  NOT NULL,
    TAX_START   DATE    NOT NULL
);

-- 部署マスタ作成
CREATE TABLE DEPARTMENTS(
    DEPARTMENT_CODE varchar(4)  PRIMARY KEY,
    DEPARTMENT_NAME varchar(10) NOT NULL,
    DELETE_FLAG     BOOLEAN DEFAULT 0 NOT NULL
);

-- ユーザ表作成
CREATE TABLE USERS(
    USER_CODE   VARCHAR(8)  PRIMARY KEY,
    USER_NAME   VARCHAR(8)  NOT NULL,
    PASSWORD    VARCHAR(64) NOT NULL,
    POSITION    INT(1)      DEFAULT 0 NOT NULL,
    DELETE_FLAG BOOLEAN     DEFAULT 0 NOT NULL,
	DEPARTMENT_CODE varchar(4),
	FOREIGN KEY DEPT_CODE_FK(DEPARTMENT_CODE)
    REFERENCES DEPARTMENTS(DEPARTMENT_CODE)
);

-- カラーマスタ作成
CREATE TABLE COLORS(
    COLOR_CODE      VARCHAR(3)  PRIMARY KEY,
    COLOR           VARCHAR(10) NOT NULL,
    DIVISION        VARCHAR(3) DEFAULT 'COL',
    GENERAL_CODE        VARCHAR(3) NOT NULL,
    FOREIGN KEY GEN_CODE_FK(DIVISION, GENERAL_CODE)
    REFERENCES GENERALS(DIVISION, GENERAL_CODE)
);

-- 商品マスタ作成
CREATE TABLE PRODUCTS(
    PRODUCT_CODE    VARCHAR(8),
    COLOR_CODE      VARCHAR(3),
    PRODUCT_NAME    VARCHAR(50) NOT NULL,
    BRAND           VARCHAR(10),
    CLASS           VARCHAR(6)  NOT NULL,
    TYPE            VARCHAR(6)  NOT NULL,
    SIZE            VARCHAR(20),
    MATERIAL_FRONT  VARCHAR(8),
    MATERIAL_INSIDE VARCHAR(8),
    JANCODE         BIGINT(12) UNIQUE,
    PRICE           INT(8)  DEFAULT 0 NOT NULL,
    STOCK           INT(6)  DEFAULT 0 NOT NULL,
    ALLOCATION      INT(6)  DEFAULT 0 NOT NULL,
    DELETE_FLAG     BOOLEAN DEFAULT 0 NOT NULL,
    PRIMARY KEY(PRODUCT_CODE, COLOR_CODE),
    FOREIGN KEY COL_CODE_FK(COLOR_CODE)
    REFERENCES COLORS(COLOR_CODE)
);

-- 取引先マスタ作成
CREATE TABLE SUPPLIERS(
    SUPPLIER_CODE   INT(6)  PRIMARY KEY AUTO_INCREMENT,
    SUPPLIER_NAME   VARCHAR(50) NOT NULL,
    PHONE_NUMBER    VARCHAR(13) NOT NULL,
    POSTAL_NUMBER   CHAR(8)  NOT NULL,
    ADDRESS         VARCHAR(50) NOT NULL,
    DELETE_FLAG     BOOLEAN DEFAULT 0 NOT NULL
);

-- 受注表作成
CREATE TABLE ORDERS(
    ORDER_CODE      INT(8)  PRIMARY KEY AUTO_INCREMENT,
    ORDER_DATE      DATE    NOT NULL,
    DELIVERY_DATE   DATE,
    DELETE_FLAG     BOOLEAN DEFAULT 0 NOT NULL,
    SUPPLIER_CODE   INT(6)  NOT NULL,
    TAX_CODE        INT(2)  NOT NULL,
    DEPARTMENT_CODE VARCHAR(4)  NOT NULL,
    USER_CODE       VARCHAR(8)  NOT NULL,
    FOREIGN KEY SUP_CODE_FK(SUPPLIER_CODE)
    REFERENCES SUPPLIERS(SUPPLIER_CODE),
    FOREIGN KEY TAX_CODE_FK(TAX_CODE)
    REFERENCES TAXS(TAX_CODE),
    FOREIGN KEY DEPT_CODE_FK(DEPARTMENT_CODE)
    REFERENCES DEPARTMENTS(DEPARTMENT_CODE),
    FOREIGN KEY USER_CODE_FK(USER_CODE)
    REFERENCES USERS(USER_CODE)
);

-- 受注明細表作成
CREATE TABLE DETAILS(
    ORDER_CODE      INT(8),
    DETAIL_CODE     INT(4),
    ORDER_COUNT     INT(8)  NOT NULL,
    ORDER_PRICE     INT(8)  NOT NULL,
    DELETE_FLAG     BOOLEAN DEFAULT 0 NOT NULL,
    PRODUCT_CODE    VARCHAR(8)  NOT NULL,
    COLOR_CODE      VARCHAR(3)  NOT NULL,
    PRIMARY KEY(ORDER_CODE, DETAIL_CODE),
    FOREIGN KEY ORD_CODE_FK(ORDER_CODE)
    REFERENCES ORDERS(ORDER_CODE),
    FOREIGN KEY PRO_CODE_FK(PRODUCT_CODE, COLOR_CODE)
    REFERENCES PRODUCTS(PRODUCT_CODE, COLOR_CODE)
);

/*---------------------データ挿入---------------------------*/

-- 部署マスタ
INSERT INTO DEPARTMENTS(DEPARTMENT_CODE, DEPARTMENT_NAME) VALUES('OPE',  'オペレーター');
INSERT INTO DEPARTMENTS(DEPARTMENT_CODE, DEPARTMENT_NAME) VALUES('SAL1', '第一営業部');
INSERT INTO DEPARTMENTS(DEPARTMENT_CODE, DEPARTMENT_NAME) VALUES('SAL2', '第二営業部');
INSERT INTO DEPARTMENTS(DEPARTMENT_CODE, DEPARTMENT_NAME) VALUES('SYS',  'システム管理者');

-- ユーザ表(パスワード:ecc)
INSERT INTO USERS(USER_CODE, USER_NAME, PASSWORD,POSITION, DEPARTMENT_CODE)
VALUES('00000001', '営業　太郎','2f7875656a69466cfdff4d57082ce7bbb1ef49284e5b5d26de2d0e0662e0ba31', 0, 'SAL1');
INSERT INTO USERS(USER_CODE, USER_NAME, PASSWORD,POSITION, DEPARTMENT_CODE)
VALUES('00000002', '営業　二郎','2f7875656a69466cfdff4d57082ce7bbb1ef49284e5b5d26de2d0e0662e0ba31', 1, 'SAL1');
INSERT INTO USERS(USER_CODE, USER_NAME, PASSWORD,POSITION, DEPARTMENT_CODE)
VALUES('00000003', '営業　三郎','2f7875656a69466cfdff4d57082ce7bbb1ef49284e5b5d26de2d0e0662e0ba31', 0, 'SAL2');
INSERT INTO USERS(USER_CODE, USER_NAME, PASSWORD,POSITION, DEPARTMENT_CODE)
VALUES('00000004', '営業　四郎','2f7875656a69466cfdff4d57082ce7bbb1ef49284e5b5d26de2d0e0662e0ba31', 1, 'SAL2');
INSERT INTO USERS(USER_CODE, USER_NAME, PASSWORD,POSITION, DEPARTMENT_CODE)
VALUES('00000005', 'オペ　花子','2f7875656a69466cfdff4d57082ce7bbb1ef49284e5b5d26de2d0e0662e0ba31', 0, 'OPE');
INSERT INTO USERS(USER_CODE, USER_NAME, PASSWORD,POSITION, DEPARTMENT_CODE)
VALUES('00000006', 'オペ　武夫','2f7875656a69466cfdff4d57082ce7bbb1ef49284e5b5d26de2d0e0662e0ba31', 1, 'OPE');
INSERT INTO USERS(USER_CODE, USER_NAME, PASSWORD, POSITION, DEPARTMENT_CODE)
VALUES('99999999','管理者ユーザ','2f7875656a69466cfdff4d57082ce7bbb1ef49284e5b5d26de2d0e0662e0ba31',9, 'SYS');

-- 税率マスタ
INSERT INTO TAXS(TAX, TAX_START) VALUES(0,  '1000-10-01');
INSERT INTO TAXS(TAX, TAX_START) VALUES(3,  '1989-4-01');
INSERT INTO TAXS(TAX, TAX_START) VALUES(5,  '1997-4-01');
INSERT INTO TAXS(TAX, TAX_START) VALUES(8,  '2014-4-01');
INSERT INTO TAXS(TAX, TAX_START) VALUES(10, '2019-10-01');

-- 取引先マスタ
INSERT INTO SUPPLIERS(SUPPLIER_NAME, PHONE_NUMBER, POSTAL_NUMBER, ADDRESS) VALUES('株式会社　テストデータ',         '06-9999-0000', '523-2354', '大阪府豊中市岡町南5-7-43');
INSERT INTO SUPPLIERS(SUPPLIER_NAME, PHONE_NUMBER, POSTAL_NUMBER, ADDRESS) VALUES('株式会社　高砂工場',             '06-9999-1111', '512-8100', '大阪府大阪市北区中崎町1-1-23');
INSERT INTO SUPPLIERS(SUPPLIER_NAME, PHONE_NUMBER, POSTAL_NUMBER, ADDRESS) VALUES('株式会社　スラムダンク',         '06-9999-2222', '564-2954', '大阪府大阪市中央区蕎麦橋5-2-68');
INSERT INTO SUPPLIERS(SUPPLIER_NAME, PHONE_NUMBER, POSTAL_NUMBER, ADDRESS) VALUES('株式会社　損座石内建設',         '06-9999-3333', '580-5230', '大阪府大阪市中央区高麗橋2-3-66');
INSERT INTO SUPPLIERS(SUPPLIER_NAME, PHONE_NUMBER, POSTAL_NUMBER, ADDRESS) VALUES('株式会社　ファンクション',       '05-9999-4444', '524-7673', '京都府京都市右京区2-7-84');
INSERT INTO SUPPLIERS(SUPPLIER_NAME, PHONE_NUMBER, POSTAL_NUMBER, ADDRESS) VALUES('株式会社　オーバーロード',       '06-9999-5555', '553-2543', '大阪府東大阪市小阪1-2-42');
INSERT INTO SUPPLIERS(SUPPLIER_NAME, PHONE_NUMBER, POSTAL_NUMBER, ADDRESS) VALUES('株式会社　ゲーミムクリーク',     '05-9999-6666', '567-8928', '京都府京都市西京区2-7-84');
INSERT INTO SUPPLIERS(SUPPLIER_NAME, PHONE_NUMBER, POSTAL_NUMBER, ADDRESS) VALUES('株式会社　EXTENDS',              '06-9999-7777', '421-6677', '大阪府大阪市都島区善源寺町区2-2-11');
INSERT INTO SUPPLIERS(SUPPLIER_NAME, PHONE_NUMBER, POSTAL_NUMBER, ADDRESS) VALUES('株式会社　ANALOG GAME',          '06-9999-8888', '457-1382', '大阪府大阪市住吉区長居東1-4-84');
INSERT INTO SUPPLIERS(SUPPLIER_NAME, PHONE_NUMBER, POSTAL_NUMBER, ADDRESS) VALUES('株式会社　開場コーポレーション', '06-9999-9999', '520-3954', '大阪府大阪市北区神山町4-2-26');

-- 汎用マスタ
INSERT INTO GENERALS VALUES('BLD','HK',  'テストブラントHK');
INSERT INTO GENERALS VALUES('BLD','HKW', 'テストブラントHKW');
INSERT INTO GENERALS VALUES('BLD','RK',  'テストブラントRK');
INSERT INTO GENERALS VALUES('BLD','MZ',  'テストブラントMZ');
INSERT INTO GENERALS VALUES('BLD','ZN',  'テストブラントZN');
INSERT INTO GENERALS VALUES('BLD','ZY',  'テストブラントZY');
INSERT INTO GENERALS VALUES('BLD','AC',  'テストブラントAC');
INSERT INTO GENERALS VALUES('BLD','KT',  'テストブラントKT');
INSERT INTO GENERALS VALUES('BLD','SN',  'テストブラントSN');
INSERT INTO GENERALS VALUES('COR','0','白');
INSERT INTO GENERALS VALUES('COR','1','黒');
INSERT INTO GENERALS VALUES('COR','2','茶');
INSERT INTO GENERALS VALUES('COR','3','赤');
INSERT INTO GENERALS VALUES('COR','4','橙');
INSERT INTO GENERALS VALUES('COR','5','黄');
INSERT INTO GENERALS VALUES('COR','6','緑');
INSERT INTO GENERALS VALUES('COR','7','青');
INSERT INTO GENERALS VALUES('COR','8','紫');
INSERT INTO GENERALS VALUES('COR','9','その他');
INSERT INTO GENERALS VALUES('CLS','1','婦人');
INSERT INTO GENERALS VALUES('CLS','2','紳士');
INSERT INTO GENERALS VALUES('CLS','3','子供');
INSERT INTO GENERALS VALUES('CLS','4','ユニセックス');
INSERT INTO GENERALS VALUES('TYP','1','定番');
INSERT INTO GENERALS VALUES('TYP','2','スポット');
INSERT INTO GENERALS VALUES('TYP','3','特価');
INSERT INTO GENERALS VALUES('MTL','1', '馬革');
INSERT INTO GENERALS VALUES('MTL','2', '牛革');
INSERT INTO GENERALS VALUES('MTL','3', '豚革');
INSERT INTO GENERALS VALUES('MTL','4', '蛇革');
INSERT INTO GENERALS VALUES('MTL','5', '山羊革');
INSERT INTO GENERALS VALUES('MTL','6', 'ゴート革');
INSERT INTO GENERALS VALUES('MTL','7', '水牛');
INSERT INTO GENERALS VALUES('MTL','8', '天然皮革');
INSERT INTO GENERALS VALUES('MTL','9', '合成皮革');
INSERT INTO GENERALS VALUES('MTL','10','帆布');
INSERT INTO GENERALS VALUES('MTL','11','綿');
INSERT INTO GENERALS VALUES('MTL','12','デニム');
INSERT INTO GENERALS VALUES('MTL','13','ナイロン');
INSERT INTO GENERALS VALUES('MTL','14','レース');

-- カラーマスタ
INSERT INTO COLORS VALUES('2', 'WHITE',     'COR', '0');
INSERT INTO COLORS VALUES('3', 'O/WHITE',   'COR', '0');
INSERT INTO COLORS VALUES('4', 'IVORI',     'COR', '0');
INSERT INTO COLORS VALUES('11','GRAY',      'COR', '1');
INSERT INTO COLORS VALUES('12','BLACK',     'COR', '1');
INSERT INTO COLORS VALUES('15','SILVER',    'COR', '1');
INSERT INTO COLORS VALUES('16','NICKEL',    'COR', '1');
INSERT INTO COLORS VALUES('21','CAMEL',     'COR', '2');
INSERT INTO COLORS VALUES('22','BROWN',     'COR', '2');
INSERT INTO COLORS VALUES('23','CHOCO',     'COR', '2');
INSERT INTO COLORS VALUES('24','BEIGE',     'COR', '2');
INSERT INTO COLORS VALUES('26','BRONZE',    'COR', '2');
INSERT INTO COLORS VALUES('30','L/PINK',    'COR', '3');
INSERT INTO COLORS VALUES('31','PINK',      'COR', '3');
INSERT INTO COLORS VALUES('32','RED',       'COR', '3');
INSERT INTO COLORS VALUES('33','WINE',      'COR', '3');
INSERT INTO COLORS VALUES('42','ORANGE',    'COR', '4');
INSERT INTO COLORS VALUES('51','LEMON',     'COR', '5');
INSERT INTO COLORS VALUES('52','YELLOW',    'COR', '5');
INSERT INTO COLORS VALUES('53','MUSTARD',   'COR', '5');
INSERT INTO COLORS VALUES('55','GOLD',      'COR', '5');
INSERT INTO COLORS VALUES('56','A/GOLD',    'COR', '5');
INSERT INTO COLORS VALUES('61','OLIVE',     'COR', '6');
INSERT INTO COLORS VALUES('62','GREEN',     'COR', '6');
INSERT INTO COLORS VALUES('63','KHAKI',     'COR', '6');
INSERT INTO COLORS VALUES('71','SKYBLUE',   'COR', '7');
INSERT INTO COLORS VALUES('72','BLUE',      'COR', '7');
INSERT INTO COLORS VALUES('73','NAVY',      'COR', '7');
INSERT INTO COLORS VALUES('75','TURQUOISE', 'COR', '7');
INSERT INTO COLORS VALUES('81','LAVENDER',  'COR', '8');
INSERT INTO COLORS VALUES('82','PURPLE',    'COR', '8');
INSERT INTO COLORS VALUES('83','VIOLET',    'COR', '8');
INSERT INTO COLORS VALUES('99','ASSORTED',  'COR', '9');

-- 商品マスタ
INSERT INTO PRODUCTS VALUES('KT0001', '12','テスト革財布','KT','2','1','100×200×150','天然皮革','合成皮革',123456789001,1000,20 ,0,0);
INSERT INTO PRODUCTS VALUES('KT0001', '22','テスト革財布','KT','2','1','100×200×150','天然皮革','合成皮革',123456789002,1000,20 ,0,0);
INSERT INTO PRODUCTS VALUES('KT0001', '32','テスト革財布','KT','2','1','100×200×150','天然皮革','合成皮革',123456789003,1000,20 ,0,0);
INSERT INTO PRODUCTS VALUES('KT0001', '15','テスト革財布','KT','2','1','100×200×150','天然皮革','合成皮革',123456789004,1700,10 ,0,0);
INSERT INTO PRODUCTS VALUES('KT0001', '55','テスト革財布','KT','2','1','100×200×150','天然皮革','合成皮革',123456789005,2100,10 ,0,0);
INSERT INTO PRODUCTS VALUES('SN1111', '31','テスト牛革',  'SN','2','1','90×30×10'   ,'牛革'    ,'山羊革'  ,987654321001,2400,5  ,0,0);
INSERT INTO PRODUCTS VALUES('SN1111', '32','テスト牛革',  'SN','2','1','90×30×10'   ,'牛革'    ,'山羊革'  ,987654321002,2400,15 ,0,0);
INSERT INTO PRODUCTS VALUES('SN1111', '33','テスト牛革',  'SN','2','1','90×30×10'   ,'牛革'    ,'山羊革'  ,987654321003,2400,25 ,0,0);


-- データ確定
COMMIT;


/* ----------------------データ表示---------------------------

SELECT * FROM GENERALS;
SELECT * FROM TAXS;
SELECT * FROM DEPARTMENTS;
SELECT * FROM USERS;
SELECT * FROM COLORS;
SELECT * FROM PRODUCTS;
SELECT * FROM SUPPLIERS;
SELECT * FROM ORDERS;
SELECT * FROM DETAILS;
*/